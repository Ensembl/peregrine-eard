>> test

linearize 1

>> input

let x : length(tr) = 0;

>> built strip

test:2 (r1) <- #1 0
test:2 let x
test:2 (x) <- #2 r1
test:2 x <check> length(tr)

>> linearize strip

test:2 1 <constant> 0
test:2 2 <copy-from> 1
test:2 3 <copy-from> 2
test:2 4 <copy-from> 3
test:2 4 <check> length(tr)

>> test

linearize 2

>> input

let x : length(tr) = 0;
let y = x;

>> built strip

test:2 (r1) <- #1 0
test:2 let x
test:2 (x) <- #2 r1
test:2 x <check> length(tr)
test:3 (r2) <- #3 x
test:3 let y
test:3 (y) <- #4 r2

>> linearize strip

test:2 1 <constant> 0
test:2 2 <copy-from> 1
test:2 3 <copy-from> 2
test:2 4 <copy-from> 3
test:2 4 <check> length(tr)
test:3 5 <copy-from> 4
test:3 6 <copy-from> 5
test:3 7 <copy-from> 6
test:3 8 <copy-from> 7

>> test

linearize 3

>> input

let a.a = 1;
let a.b = 2;
let a.c = 3;
let *b = *a;
let x = b.a;
let y = b.b;

>> built strip

test:2 (r1) <- #1 1
test:2 let a.a
test:2 (a.a) <- #2 r1
test:3 (r2) <- #3 2
test:3 let a.b
test:3 (a.b) <- #4 r2
test:4 (r3) <- #5 3
test:4 let a.c
test:4 (a.c) <- #6 r3
test:5 (*r4) <- #7 *a
test:5 let *b
test:5 (*b) <- #8 *r4
test:6 (r5) <- #9 b.a
test:6 let x
test:6 (x) <- #10 r5
test:7 (r6) <- #11 b.b
test:7 let y
test:7 (y) <- #12 r6

>> linearize strip

test:2 1 <constant> 1
test:2 2 <copy-from> 1
test:2 3 <copy-from> 2
test:2 4 <copy-from> 3

test:3 5 <constant> 2
test:3 6 <copy-from> 5
test:3 7 <copy-from> 6
test:3 8 <copy-from> 7

test:4 9 <constant> 3
test:4 10 <copy-from> 9
test:4 11 <copy-from> 10
test:4 12 <copy-from> 11

test:5 13 <copy-from> 4
test:5 14 <copy-from> 8
test:5 15 <copy-from> 13
test:5 16 <copy-from> 14

test:5 17 <copy-from> 15
test:5 18 <copy-from> 16
test:5 19 <copy-from> 17
test:5 20 <copy-from> 18

test:6 21 <copy-from> 19
test:6 22 <copy-from> 21
test:6 23 <copy-from> 22
test:6 24 <copy-from> 23

test:7 25 <copy-from> 20
test:7 26 <copy-from> 25
test:7 27 <copy-from> 26
test:7 28 <copy-from> 27

>> test

linearize 4

>> input

procedure p(x) { x }

let z = 0;
z = p(1);

>> built strip

0:proc (x) {
  (x)
}

test:2 define 0
test:4 (r1) <- #1 0
test:4 let z
test:4 (z) <- #2 r1
test:5 (r2) <- (0#3 1)
test:5 (z) <- #4 r2

>> linearize strip

test:4 1 <constant> 0
test:4 2 <copy-from> 1
test:4 3 <copy-from> 2
test:4 4 <copy-from> 3

test:5 5 <constant> 1
test:5 6 <copy-from> 5
test:5 7 <copy-from> 6
test:5 8 <copy-from> 7
test:5 9 <copy-from> 8

>> test

linearize 5

>> input

procedure p(*x) { x.a }

let a = 0;
let x.a = 1;
let x.b = 2;
a = p(*x);

>> built strip

0:proc (*x) {
  (x.a)
}

test:2 define 0
test:4 (r1) <- #1 0
test:4 let a
test:4 (a) <- #2 r1
test:5 (r2) <- #3 1
test:5 let x.a
test:5 (x.a) <- #4 r2
test:6 (r3) <- #5 2
test:6 let x.b
test:6 (x.b) <- #6 r3
test:7 (r4) <- (0#7 *x)
test:7 (a) <- #8 r4

>> linearize strip

test:4 1 <constant> 0
test:4 2 <copy-from> 1
test:4 3 <copy-from> 2
test:4 4 <copy-from> 3

test:5 5 <constant> 1
test:5 6 <copy-from> 5
test:5 7 <copy-from> 6
test:5 8 <copy-from> 7

test:6 9 <constant> 2
test:6 10 <copy-from> 9
test:6 11 <copy-from> 10
test:6 12 <copy-from> 11

test:7 13 <copy-from> 8
test:7 14 <copy-from> 13
test:7 15 <copy-from> 14
test:7 16 <copy-from> 15
test:7 17 <copy-from> 16

>> test

linearize 6

>> input

procedure p(*x) { let b.w = x.a; *b }

let a = 0;
let x.a = 1;
let x.b = 2;
let *z = p(*x);
a = z.w;

>> built strip

0:proc (*x) {
  test:2 (r1) <- #1 x.a
  test:2 let b.w
  test:2 (b.w) <- #2 r1
  (*b)
}

test:2 define 0
test:4 (r2) <- #3 0
test:4 let a
test:4 (a) <- #4 r2
test:5 (r3) <- #5 1
test:5 let x.a
test:5 (x.a) <- #6 r3
test:6 (r4) <- #7 2
test:6 let x.b
test:6 (x.b) <- #8 r4
test:7 (*r5) <- (0#9 *x)
test:7 let *z
test:7 (*z) <- #10 *r5
test:8 (r6) <- #11 z.w
test:8 (a) <- #12 r6

>> linearize strip

test:4 1 <constant> 0
test:4 2 <copy-from> 1
test:4 3 <copy-from> 2
test:4 4 <copy-from> 3

test:5 5 <constant> 1
test:5 6 <copy-from> 5
test:5 7 <copy-from> 6
test:5 8 <copy-from> 7

test:6 9 <constant> 2
test:6 10 <copy-from> 9
test:6 11 <copy-from> 10
test:6 12 <copy-from> 11

test:7 13 <copy-from> 8
test:7 14 <copy-from> 13

test:2 15 <copy-from> 14
test:2 16 <copy-from> 15
test:2 17 <copy-from> 16
test:2 18 <copy-from> 17

test:7 19 <copy-from> 18
test:7 20 <copy-from> 19
test:7 21 <copy-from> 20

test:8 22 <copy-from> 21
test:8 23 <copy-from> 22
test:8 24 <copy-from> 23
test:8 25 <copy-from> 24

>> test 

linearize 7

>> input

function f(*x) { let c.g = x.w; *c }
procedure p(*x) { let b.w = x.a; f(*b) }

let a = 0;
let x.a = 1;
let x.b = 2;
let *z = p(*x);
a = z.g;

>> built strip

0:func (*x) {
  test:2 (r1) <- #1 x.w
  test:2 let c.g
  test:2 (c.g) <- #2 r1
  (*c)
}

1:proc (*x) {
  test:3 (r2) <- #3 x.a
  test:3 let b.w
  test:3 (b.w) <- #4 r2
  ((0#5 *b))
}

test:2 define 0
test:3 define 1
test:5 (r3) <- #6 0
test:5 let a
test:5 (a) <- #7 r3
test:6 (r4) <- #8 1
test:6 let x.a
test:6 (x.a) <- #9 r4
test:7 (r5) <- #10 2
test:7 let x.b
test:7 (x.b) <- #11 r5
test:8 (*r6) <- (1#12 *x)
test:8 let *z
test:8 (*z) <- #13 *r6
test:9 (r7) <- #14 z.g
test:9 (a) <- #15 r7

>> linearize strip

test:5 1 <constant> 0
test:5 2 <copy-from> 1
test:5 3 <copy-from> 2
test:5 4 <copy-from> 3

test:6 5 <constant> 1
test:6 6 <copy-from> 5
test:6 7 <copy-from> 6
test:6 8 <copy-from> 7

test:7 9 <constant> 2
test:7 10 <copy-from> 9
test:7 11 <copy-from> 10
test:7 12 <copy-from> 11

test:8 13 <copy-from> 8
test:8 14 <copy-from> 13
test:3 15 <copy-from> 14
test:3 16 <copy-from> 15
test:3 17 <copy-from> 16
test:3 18 <copy-from> 17
test:8 19 <copy-from> 18
test:8 20 <copy-from> 19
test:2 21 <copy-from> 20
test:2 22 <copy-from> 21
test:2 23 <copy-from> 22
test:2 24 <copy-from> 23
test:8 25 <copy-from> 24
test:8 26 <copy-from> 25
test:8 27 <copy-from> 26
test:9 28 <copy-from> 27
test:9 29 <copy-from> 28
test:9 30 <copy-from> 29
test:9 31 <copy-from> 30

>> test

linearize 8

>> input

function f(*x) { let c.g = x.b; *c }
procedure p(*x) { let b.w = x.g; *b }

let a = 0;
let x.a = 1;
let x.b = 2;
let *z = p(f(*x));
a = z.w;

>> built strip

0:func (*x) {
  test:2 (r1) <- #1 x.b
  test:2 let c.g
  test:2 (c.g) <- #2 r1
  (*c)
}

1:proc (*x) {
  test:3 (r2) <- #3 x.g
  test:3 let b.w
  test:3 (b.w) <- #4 r2
  (*b)
}

test:2 define 0
test:3 define 1
test:5 (r3) <- #5 0
test:5 let a
test:5 (a) <- #6 r3
test:6 (r4) <- #7 1
test:6 let x.a
test:6 (x.a) <- #8 r4
test:7 (r5) <- #9 2
test:7 let x.b
test:7 (x.b) <- #10 r5
test:8 (*r6) <- (1#12 (0#11 *x))
test:8 let *z
test:8 (*z) <- #13 *r6
test:9 (r7) <- #14 z.w
test:9 (a) <- #15 r7

>> linearize strip

test:5 1 <constant> 0
test:5 2 <copy-from> 1
test:5 3 <copy-from> 2
test:5 4 <copy-from> 3

test:6 5 <constant> 1
test:6 6 <copy-from> 5
test:6 7 <copy-from> 6
test:6 8 <copy-from> 7

test:7 9 <constant> 2
test:7 10 <copy-from> 9
test:7 11 <copy-from> 10
test:7 12 <copy-from> 11

test:8 13 <copy-from> 12
test:8 14 <copy-from> 13
test:2 15 <copy-from> 14
test:2 16 <copy-from> 15
test:2 17 <copy-from> 16
test:2 18 <copy-from> 17
test:8 19 <copy-from> 18
test:3 20 <copy-from> 19
test:3 21 <copy-from> 20
test:3 22 <copy-from> 21
test:3 23 <copy-from> 22
test:8 24 <copy-from> 23
test:8 25 <copy-from> 24
test:8 26 <copy-from> 25

test:9 27 <copy-from> 26
test:9 28 <copy-from> 27
test:9 29 <copy-from> 28
test:9 30 <copy-from> 29

>> test

linearize 9

>> input

function f(x,y) { x }
procedure p(z) { z }

let x.a = 1;
let x.b = 2;
let x.c = 3;
let z = 4;
let **y = f(**x,z);
let (m,n) = (y.a,y.b);

>> built strip

0:func (x,y) {
  (x)
}

1:proc (z) {
  (z)
}

test:2 define 0
test:3 define 1
test:5 (r1) <- #1 1
test:5 let x.a
test:5 (x.a) <- #2 r1
test:6 (r2) <- #3 2
test:6 let x.b
test:6 (x.b) <- #4 r2
test:7 (r3) <- #5 3
test:7 let x.c
test:7 (x.c) <- #6 r3
test:8 (r4) <- #7 4
test:8 let z
test:8 (z) <- #8 r4
test:9 let **y
test:9 (**y) <- #10 (0#9 **x z)
test:10 (r5) <- #11 y.a
test:10 (r6) <- #12 y.b
test:10 let m
test:10 let n
test:10 (m) <- #13 r5
test:10 (n) <- #14 r6

>> linearize strip

test:5 1 <constant> 1
test:5 2 <copy-from> 1
test:5 3 <copy-from> 2
test:5 4 <copy-from> 3

test:6 5 <constant> 2
test:6 6 <copy-from> 5
test:6 7 <copy-from> 6
test:6 8 <copy-from> 7

test:7 9 <constant> 3
test:7 10 <copy-from> 9
test:7 11 <copy-from> 10
test:7 12 <copy-from> 11

test:8 13 <constant> 4
test:8 14 <copy-from> 13
test:8 15 <copy-from> 14
test:8 16 <copy-from> 15

test:9 17 <copy-from> 4
test:9 18 <copy-from> 16
test:9 19 <copy-from> 17
test:9 20 <copy-from> 18
test:9 21 <copy-from> 19

test:9 22 <copy-from> 8
test:9 23 <copy-from> 16
test:9 24 <copy-from> 22
test:9 25 <copy-from> 23
test:9 26 <copy-from> 24

test:10 27 <copy-from> 21
test:10 28 <copy-from> 27
test:10 29 <copy-from> 26
test:10 30 <copy-from> 29
test:10 31 <copy-from> 28
test:10 32 <copy-from> 31
test:10 33 <copy-from> 30
test:10 34 <copy-from> 33
